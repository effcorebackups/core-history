

Безопасность
---------------------------------------------------------------------

Немаловажным фактором в системе является безопасность.

Были рассмотрены следующие векторы атак:

- Злоумышленник может попытаться получить доступ к данным SQLite, ключам системы.
- Злоумышленник может попытаться получить доступ к таким файлам как ".htaccess", ".nginx",
  "web.config", директории "/.git/", "/dynamic/tmp/.git_restore-system/" и другим подобным.
- Злоумышленник может попытаться найти слабое место в директивах в файле настроек
  веб-сервера (".htaccess", ".nginx", "web.config") если директив много и/или они составлены
  некорректно и/или не учитывают все возможные ситуации и/или после обновления
  программного обеспечения изменились правила оформления директив в таких файлах.
- Злоумышленник может попытаться получить доступ к файлам вне пределов корневой веб-директории
  манипулируя такими комбинациями как "./", "../", "~/", "//" и другими.
- Злоумышленник может попытаться ввести в поля формы данные для SQL-инъекции.
- Злоумышленник может попытаться подделать идентификатор сеанса.
- Злоумышленник может попытаться многократно послать предварительно заполненную
  форму (форму аутентификации "form_login", форму регистрации нового пользователя "form_registration",
  форму восстановления пароля "form_recovery") с целью подбора адреса электронной почты и/или
  имени пользователя и/или пароля или обхода CAPTCHA.
- Злоумышленник может попытаться разблокировать в форме заблокированные поля средствами браузера.
- Злоумышленник может попытаться послать большее значение поля чем разрешено атрибутами
  "maxlength", "max", "step", "min", "max" и другими.
- Злоумышленник может попытаться осуществить GET/POST-запросы с символами, которые
  недопустимы стандартами RFC.
- Злоумышленник может попытаться осуществить GET/POST-запросы в которых размерность
  передаваемых массивов или их индексы могут не соответствовать допустимым.
- Злоумышленник может попытаться подставить ошибочные аргументы
  в запросе URL (http://domain/path?QUERY).
- Злоумышленник может попытаться внести в поля формы вредоносный код (JavaScript).
- Злоумышленник может попытаться загрузить изображение с вредоносным содержимым.
- Злоумышленник может попытаться получить доступ к профилю пользователя
  имея временный доступ к его рабочему месту.


Реализованные решения по обеспечению безопасности
---------------------------------------------------------------------

Файловый вектор:

- Файлы настроек веб-сервера (".htaccess", ".nginx", "web.config") содержат директивы,
  запрещающие доступ пользовательского агента к директориям "/dynamic/cache/",
  "/dynamic/data/", "/dynamic/logs/". Злоумышленник не сможет получить доступ
  к данным SQLite, ключам системы.
- Файлы настроек веб-сервера (".htaccess", ".nginx", "web.config") содержат директиву,
  запрещающую доступ пользовательского агента к любым файлам или директориям, чьё имя
  начинается с символа "." на любом уровне вложенности. Злоумышленник не сможет получить
  доступ к таким файлам как ".htaccess", ".nginx", директории "/.git/",
  "/dynamic/tmp/.git_restore-system/" и другим подобным.
- Файлы настроек веб-сервера (".htaccess", ".nginx", "web.config") содержат директиву,
  запрещающую доступ пользовательского агента к файлу "web.config" на любом уровне
  вложенности. Злоумышленник не сможет получить доступ к файлу "web.config".
- Файлы настроек веб-сервера (".htaccess", ".nginx", "web.config") содержат директиву,
  обеспечивающую единую точку входа в файл "index.php", что гарантирует единый
  и не противоречивый подход к защите любого файла системы.
- Дополнительно, на уровне PHP, системой обеспечивается ограничение доступа пользовательского
  агента к файловой системе веб-сервера вне пределов корневой веб-директории.
- Дополнительно, на уровне PHP, системой обеспечивается фильтрация в запросах URL, в которых
  содержатся такие комбинации как "./", "../", "~/", "//".
- Дополнительно, на уровне PHP, системой обеспечивается доступа пользовательского агента
  только к реально существующему файлу (кроме типа "kind: virtual").
  При этом PHP-скрипт должен иметь право на чтение запрашиваемого файла.
- На уровне PHP системой ограничивается доступ к файлам, тип которых задан
  как "protected" ("kind: protected").
- На уровне PHP системой могут быть организованы дополнительные ограничения
  на доступ к любому типу файла (по требованию разработчика через обработчик
  события "on_load").

Вектор БД:

- Перед выполнением любого SQL-запроса производится его подготовка (препарация),
  что исключает возможность SQL-инъекций.

Сеансовый вектор:

- Идентификатор сеанса "session_id" подписывается ключом "settings/core/keys/session",
  расположенным на стороне веб-сервера, что делает его подделку невозможной.
- Идентификатор сеанса может содержать наименование пользовательского агента и
  его IP-адрес (при аутентификации пользователь сам определяет, следует ли
  осуществлять привязку его сеанса к его IP-адресу), что делает перехват
  идентификатора сеанса бессмысленной процедурой — запрос злоумышленника
  с другого IP-адреса будет проигнорирован.
- Идентификатор сеанса может иметь кратковременный период действия (при
  аутентификации пользователь сам определяет является ли его сеанс
  кратковременным или нет).
- Идентификатор сеанса по умолчанию не является кросс-доменным, т.е.
  не передаётся на домены третьих сторон.

Вектор HTTP-запроса:

- Валидационный идентификатор формы "validation_id" подписывается ключом
  "settings/core/keys/form_validation", расположенным на стороне веб-сервера,
  что делает его подделку невозможной.
- Валидационный идентификатор формы содержит наименование пользовательского агента и
  его IP-адрес, что делает перехват идентификатора бессмысленной процедурой — запрос
  злоумышленника с другого IP-адреса будет проигнорирован.
  Время жизни валидационного идентификатора ограничено по времени.
- Процесс проверки (валидации) данных производится на стороне веб-сервера и попытка
  их подделки на стороне клиента бессмысленна (например, попытка разблокировать в форме
  заблокированные поля или попытка внести в поля недопустимые данные).
- Данные GET/POST-запроса проходят проверку на соответствие стандартам RFC
  и попытка вызвать URL с недопустимыми символами будет обработана корректно.
- Данные GET/POST-запроса проходят проверку на соответствие размерностей массивов и их индексов.
- Аргументы запроса URL (http://domain/path?QUERY) проходят фильтрацию.
- Базовый модуль CAPTCHA позволяет минимизировать возможность перебора адреса
  электронной почты и пароля в форме аутентификации "form_login",
  перебора адреса электронной почты и/или имени пользователя в форме регистрации нового
  пользователя "form_registration", перебора адреса электронной почты в форме
  восстановления доступа "form_recovery", а также регистрации спам-роботов в форме
  регистрации нового пользователя "form_registration".
- Фильтрация вводимых данных не позволяет внести в систему вредоносный код (JavaScript).
- Фильтрация выводимых данных не позволяет отобразить вредоносный код (JavaScript).
- Фильтрация изображений исключает возможность показа пользователям изображения
  с вредоносным содержимым.

Организационный вектор:

- Система разрешений и ролей производит выдачу расширенных прав только авторизованным лицам.
- Доступ к профилям других пользователей имеют только администраторы (например,
  пользователи с ролью "Администраторы").
- Все адреса электронной почты пользователей являются скрытыми от
  других участников системы и вычислить соответствие между именем пользователя
  и его адресом электронной почты не представляется возможным.
  Таким образом удалённо сбросить пароль другого пользователя или попытаться
  подобрать пароль к его аккаунту будет невозможно.
- Внести изменения в регистрационные данные пользователя можно только
  в случае если известен пароль от его аккаунта — это минимизирует
  внутрисистемную угрозу (угрозу безопасности со стороны персонала).

Функциональный вектор:

- Осуществлена возможность работы без JavaScript.
- Осуществлена возможность получения "Хэша последовательности" и "Хэша данных" в консоли системы.
- Детерминизм в работе системы — при одних и тех же входных параметрах выдаётся
  один и тот же результат вне зависимости от платформы, и как результат — полный отказ
  от функций, работа которых зависит от окружения (например, "setlocale" и другие).
- Использование в коде оператора тождественного равенства '===' вместо простого
  равенства '==', в результате чего исключается опасная ситуация
  вида: (0 == 'some_text') === true;
- В коде в циклах "foreach" исключение ссылок на переменные "ключ" и/или "значение"
  с последующей модификацией структуры массива с использованием этих переменных,
  что могло приводить к перекосу структуры массива и разрушению отношения
  "ключ + значение": foreach ($array as $key => &$value) if ($some) unset($value);


Рекомендации по безопасности
---------------------------------------------------------------------

- Многие службы веб-хостинга по-прежнему используют программное обеспечение,
  поддержка которого прекращена.
  Например: PHP до версии 7 или MySQL до версии 5.6.
  Это плохо для безопасности и такие сервисы необходимо обновить.
  Узнать больше о поддерживаемых версиях PHP: http://php.net/supported-versions.php
  Ознакомьтесь с политикой поддержки Oracle Lifetime Support,
  чтобы определить жизненный цикл MySQL.
- Получить максимальную защиту от внутренних угроз можно только в том случае,
  если используется собственный сервер в изолированном месте с контролем доступа.
  Если Вы размещаете сервер в центре обработки данных в общей стойке,
  нет гарантии от внешнего доступа к портам или жёстким дискам.
  Рекомендуется использовать услуги хостинга с серверами,
  расположенными в европейских дата-центрах.
- Рекомендуется использовать аппаратные межсетевые экраны на основе открытых
  прошивок (например, NanoBSD и другие). Помните, что некоторые аппаратные
  брандмауэры могут содержать бэкдоры.
- Не рекомендуется покупать SSL-сертификаты с заранее сгенерированными
  закрытыми ключами в Центре сертификации (англ. Certificate Authority). 
  Нет никаких гарантий, что Ваш закрытый ключ не попадёт в третьи руки.
  Вы можете использовать процедуру Запроса на подпись сертификата (англ.
  Certificate Signing Request):
  - сгенерировать открытые и закрытые ключи с идентифицирующей информацией на вашей стороне;
  - отправить открытый ключ с идентифицирующей информацией в Центр сертификации
    для подписания открытого ключа.
- Не рекомендуется использовать общедоступные почтовые сервисы для восстановления
  паролей и отправки важной корреспонденции. Рекомендуется использовать свой собственный сервер
  для почтовых служб и использовать разные серверы для каждой службы (если это возможно).
- Для хранения закрытых ключей рекомендуется использовать защищённый аппаратный криптопроцессор.
- Рекомендуется использовать двухфакторную аутентификацию. 
- Рекомендуется использовать TLS v1.2 или выше.

