tests
- access|test
    id: access
    title: Access
    description: After each 3 registrations you will get the message "The test was failed!" because after every 3-rd challenge the CAPTCHA will change.
    params
    - is_https|field_switcher
        title: HTTPS
        element_attributes
        - name: is_https
    scenario
  # ─────────────────────────────────────────────────────────────────────
  # anonymous user
  # ─────────────────────────────────────────────────────────────────────
    - title_for_anonymous_user|step_title
        title: ANONYMOUS USER
    # multiple instance select page
    - request_url-select-multiple|step_request
        url: /manage/data/content/text
        is_https|param_from_form
          name: is_https
    - response_check-select-multiple|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance select page
    - request_url-select|step_request
        url: /manage/data/content/text/test
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-select|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance insert page
    - request_url-insert|step_request
        url: /manage/data/content/text//insert
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-insert|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance update page
    - request_url-update|step_request
        url: /manage/data/content/text/test/update
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-update|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance delete page
    - request_url-delete|step_request
        url: /manage/data/content/text/test/delete
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-delete|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
  # ─────────────────────────────────────────────────────────────────────
  # registered user
  # ─────────────────────────────────────────────────────────────────────
    - title_for_registered_user_delimiter|step_title
        title: ==================================================================
    - title_for_registered_user|step_title
        title: REGISTERED USER
    # warming up the form for initialize CAPTCHA and Validation ID
    - form_registration_warming_up|step_request
        url: /registration
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - form_registration_submit|step_request
        url: /registration
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
        post
        - form_id: registration
        - validation_id: %%_test_form_validation_id{registration}
        - email: %%_test_email_random
        - nickname: %%_test_nickname_random{0}
        - password: %%_test_password_random
        - timezone: UTC
        - session_params[0]: is_remember
        - session_params[1]: is_fixed_ip
        - captcha: %%_test_captcha
        - button: register
    - response_check|step_check
        where: subm_errs
        match: 0
        on_failure
        - return_result|step_return
            value: 0
    # multiple instance select page
    - request_url-select-multiple-registered|step_request
        url: /manage/data/content/text
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-select-multiple-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance select page
    - request_url-select-registered|step_request
        url: /manage/data/content/text/test
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-select-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance insert page
    - request_url-insert-registered|step_request
        url: /manage/data/content/text//insert
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-insert-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance update page
    - request_url-update-registered|step_request
        url: /manage/data/content/text/test/update
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-update-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
    # instance delete page
    - request_url-delete-registered|step_request
        url: /manage/data/content/text/test/delete
        headers
        - cookie: Cookie: %%_test_cookies
        is_https|param_from_form
          name: is_https
    - response_check-delete-registered|step_check
        where: http_code
        match: 403
        on_failure
        - return_result|step_return
            value: 0
  # ─────────────────────────────────────────────────────────────────────
  # registered user + role
  # ─────────────────────────────────────────────────────────────────────
    - title_for_registered_user_ws_role_delimiter|step_title
        title: ==================================================================
    - title_for_registered_user_ws_role|step_title
        title: REGISTERED USER + ROLE
    - set_user_roles|step_set_user_roles
        nickname: %%_test_nickname_random{0}
        roles
        - =: test
        is_reset: true
    - transpositions|step_transpositions
      # ┌────╥─────────┬─────────┬─────────┬─────────┐
      # │  i ║ …select │ …insert │ …update │ …delete │
      # ╞════╬═════════╪═════════╪═════════╪═════════╡
      # │  0 ║         │         │         │         │ ← 0000
      # │  1 ║         │         │         │    x    │ ← 0001
      # │  2 ║         │         │    x    │         │ ← 0010
      # │  3 ║         │         │    x    │    x    │ ← 0011
      # │  4 ║         │    x    │         │         │ ← 0100
      # │  5 ║         │    x    │         │    x    │ ← 0101
      # │  6 ║         │    x    │    x    │         │ ← 0110
      # │  7 ║         │    x    │    x    │    x    │ ← 0111
      # │  8 ║    x    │         │         │         │ ← 1000
      # │  9 ║    x    │         │         │    x    │ ← 1001
      # │ 10 ║    x    │         │    x    │         │ ← 1010
      # │ 11 ║    x    │         │    x    │    x    │ ← 1011
      # │ 12 ║    x    │    x    │         │         │ ← 1100
      # │ 13 ║    x    │    x    │         │    x    │ ← 1101
      # │ 14 ║    x    │    x    │    x    │         │ ← 1110
      # │ 15 ║    x    │    x    │    x    │    x    │ ← 1111
      # └────╨─────────┴─────────┴─────────┴─────────┘
        action_before|step_set_role_permissions
          id_role: test
          is_reset: true
      # ─────────────────────────────────────────────────────────────────────
        actions
        - select|step_actions
            actions
            - set_role_permissions|step_set_role_permissions
                id_role: test
                permissions
                - =: text_select
        - insert|step_actions
            actions
            - set_role_permissions|step_set_role_permissions
                id_role: test
                permissions
                - =: text_insert
        - update|step_actions
            actions
            - set_role_permissions|step_set_role_permissions
                id_role: test
                permissions
                - =: text_update
        - delete|step_actions
            actions
            - set_role_permissions|step_set_role_permissions
                id_role: test
                permissions
                - =: text_delete
      # ─────────────────────────────────────────────────────────────────────
        action_after|step_actions
          actions
          # multiple instance select page
          - title_select_multiple|step_title
              title: SELECT MULTIPLE
          - request_url-select-multiple-registered-role|step_request
              url: /manage/data/content/text
              headers
              - cookie: Cookie: %%_test_cookies
              is_https|param_from_form
                name: is_https
          - response_check-select-multiple-registered-role|step_check
              where: token
              which: %%_test_step_transpositions_is_active_select
              match: 1
              on_success
              - response_check_http_code|step_check
                  where: http_code
                  match: 200
                  on_failure
                  - return_result|step_return
                      value: 0
              on_failure
              - response_check_http_code|step_check
                  where: http_code
                  match: 403
                  on_failure
                  - return_result|step_return
                      value: 0
          # instance select page
          - title_select|step_title
              title: SELECT
          - request_url-select-registered-role|step_request
              url: /manage/data/content/text/test
              headers
              - cookie: Cookie: %%_test_cookies
              is_https|param_from_form
                name: is_https
          - response_check-select-registered-role|step_check
              where: token
              which: %%_test_step_transpositions_is_active_select
              match: 1
              on_success
              - response_check_http_code|step_check
                  where: http_code
                  match: 200
                  on_failure
                  - return_result|step_return
                      value: 0
              on_failure
              - response_check_http_code|step_check
                  where: http_code
                  match: 403
                  on_failure
                  - return_result|step_return
                      value: 0
          # instance insert page
          - title_insert|step_title
              title: INSERT
          - request_url-insert-registered-role|step_request
              url: /manage/data/content/text//insert
              headers
              - cookie: Cookie: %%_test_cookies
              is_https|param_from_form
                name: is_https
          - response_check-insert-registered-role|step_check
              where: token
              which: %%_test_step_transpositions_is_active_insert
              match: 1
              on_success
              - response_check_http_code|step_check
                  where: http_code
                  match: 200
                  on_failure
                  - return_result|step_return
                      value: 0
              on_failure
              - response_check_http_code|step_check
                  where: http_code
                  match: 403
                  on_failure
                  - return_result|step_return
                      value: 0
          # instance update page
          - title_update|step_title
              title: UPDATE
          - request_url-update-registered-role|step_request
              url: /manage/data/content/text/test/update
              headers
              - cookie: Cookie: %%_test_cookies
              is_https|param_from_form
                name: is_https
          - response_check-update-registered-role|step_check
              where: token
              which: %%_test_step_transpositions_is_active_update
              match: 1
              on_success
              - response_check_http_code|step_check
                  where: http_code
                  match: 200
                  on_failure
                  - return_result|step_return
                      value: 0
              on_failure
              - response_check_http_code|step_check
                  where: http_code
                  match: 403
                  on_failure
                  - return_result|step_return
                      value: 0
          # instance delete page
          - title_delete|step_title
              title: DELETE
          - request_url-delete-registered-role|step_request
              url: /manage/data/content/text/test/delete
              headers
              - cookie: Cookie: %%_test_cookies
              is_https|param_from_form
                name: is_https
          - response_check-delete-registered-role|step_check
              where: token
              which: %%_test_step_transpositions_is_active_delete
              match: 1
              on_success
              - response_check_http_code|step_check
                  where: http_code
                  match: 200
                  on_failure
                  - return_result|step_return
                      value: 0
              on_failure
              - response_check_http_code|step_check
                  where: http_code
                  match: 403
                  on_failure
                  - return_result|step_return
                      value: 0
    - reset_role_permissions|step_set_role_permissions
        id_role: test
        is_reset: true
    - reset_user_roles|step_set_user_roles
        nickname: %%_test_nickname_random{0}
        is_reset: true
  # ─────────────────────────────────────────────────────────────────────
  # return
  # ─────────────────────────────────────────────────────────────────────
    - return_result|step_return
        value: 1